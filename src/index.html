<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://unpkg.com/chota@latest">
    <link href="gs-colorpicker.css" rel="stylesheet">
    <style>
        #test {
            position: fixed;
            white-space: nowrap;
            cursor: move;
        }
        .container {
            margin: 0 auto;
            max-width: 980px;
        }
    </style>

</head>

<body>
<div class="container">
    <label>Select an option   </label>
    <select class="select" id="changeOptions">
        <option disabled selected>Choose a Picker Option</option>
        <option value="default">GS Default</option>
        <option value="showAlpha">With Alpha Slider</option>
        <option value="showHSL">With HSL Inputs</option>
    </select>

</div>
<div class="picker"></div>
<div class="container">
    <button id="test2" class="btn btn-soft btn-info">OPEN PICKER 2</button>
</div>
<div class="container">
    <button id="test" class="btn btn-soft btn-info">DRAG OR CLICK TO OPEN PICKER</button>
</div>


<script type="module">
    import { default as GSColorPicker} from "./gs-colorpicker.js";
    const toggler = document.getElementById('test');
    let _mouseStartPos = { x : 0, y: 0 };
    let _togglerPosition = toggler.getBoundingClientRect();
    let _preventOpenAfterDrag = false;
    function moveTriggerButton(e){
        dragged = true;
        e.stopPropagation();
        e.preventDefault();
        let deltaX = e.pageX - _mouseStartPos.x;
        let deltaY = e.pageY - _mouseStartPos.y;
        let transform = `translate(${deltaX}px, ${ deltaY}px)`;
        _preventOpenAfterDrag = true;
        window.requestAnimationFrame(() => {
            toggler.style.transform = transform;
        });
    }


    let dragged = false;
    toggler.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        _mouseStartPos.x = e.pageX;
        _mouseStartPos.y = e.pageY;
        _togglerPosition = toggler.getBoundingClientRect();
        console.warn(_mouseStartPos);
        window.addEventListener('mousemove', moveTriggerButton);
        window.addEventListener('mouseup', (e) => {
            e.stopPropagation();
            e.preventDefault();
            _togglerPosition = toggler.getBoundingClientRect();
            toggler.style.left = `${_togglerPosition.x}px`;
            toggler.style.top = `${_togglerPosition.y}px`;
            toggler.style.transform = 'none';
            window.removeEventListener('mousemove', moveTriggerButton);

        });
    })
    const pickerOptions = {
        color: 'rgba(255,0,0,0.5)',
        showAlpha: false,
        showHSL: false,
        showHEX: true,
        useAlphaInPalette: true,
        paletteEditable: true,
        slBarSize: [280, 150],
        hueBarSize: [160, 11],
        alphaBarSize: [160, 11],
        afterTemplateConfiguration: function(){
            console.info('AFTER PICKER CONFIGURATION', this);
        }
    }

    changeOptions.addEventListener('change', (e) => {
        switch(e.currentTarget.value){
            case 'default':
                pickerOptions.showAlpha = false;
                pickerOptions.showHSL = false;
                break;
            case 'showAlpha':
                pickerOptions.showAlpha = true;
                pickerOptions.showHSL = false;
            break;
            case 'showHSL':
                pickerOptions.showAlpha = false;
                pickerOptions.showHSL = true;
                pickerOptions.showRGB = false;
                break;
        }
        myPicker.setOptions(pickerOptions);
        console.info('OPTION %s', e.currentTarget.value);
    })

    const myPicker = GSColorPicker.createPicker(pickerOptions);
    const myPicker2 = GSColorPicker.createPicker(pickerOptions)

    toggler.addEventListener('click', (e) => {
        if(dragged) {

            dragged = false;
            e.preventDefault()
            return;
        }
        myPicker.openPicker({target: e.currentTarget, x1: e.clientX, y1: e.clientY, color: '#30ab5d'}, (picker, color) => {
            console.info('PICKER "1" ----->', picker.color);
        });
    })

    test2.addEventListener('click', (e) => {
        myPicker2.openPicker({target: e.currentTarget, x1: e.clientX, y1: e.clientY, color: '#61259c'}, (picker, color) => {
            console.info('PICKER "2" ----->', picker.color);
        });
    })

</script>
</body>
</html>